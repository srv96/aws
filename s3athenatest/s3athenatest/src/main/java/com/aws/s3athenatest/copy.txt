

import org.apache.avro.Schema;
import org.apache.avro.generic.GenericData;
import org.apache.avro.generic.GenericRecord;
import org.apache.avro.io.DatumWriter;
import org.apache.avro.io.Encoder;
import org.apache.avro.io.EncoderFactory;
import org.apache.avro.io.JsonEncoder;
import org.apache.parquet.avro.AvroParquetWriter;
import org.apache.parquet.hadoop.ParquetWriter;
import org.apache.parquet.hadoop.metadata.CompressionCodecName;

import java.io.*;
import java.util.List;

public class ParquetConverter {

    public static InputStream convertListToParquetInputStream(List<String> dataList) throws IOException {
        // Define the Avro schema for the Parquet records
        Schema schema = new Schema.Parser().parse("{\"type\":\"record\",\"name\":\"DataRecord\",\"fields\":[{\"name\":\"data\",\"type\":\"string\"}]}");

        // Create a temporary file to store the Parquet data
        File tempFile = File.createTempFile("temp", ".parquet");
        tempFile.deleteOnExit();

        // Convert List<String> to Avro records
        DatumWriter<GenericRecord> datumWriter = new GenericData.Record(schema);
        try (ParquetWriter<GenericRecord> parquetWriter = AvroParquetWriter.<GenericRecord>builder(tempFile)
                .withSchema(schema)
                .withCompressionCodec(CompressionCodecName.SNAPPY) // You can change the compression codec if needed
                .build()) {
            for (String data : dataList) {
                GenericRecord record = new GenericData.Record(schema);
                record.put("data", data);
                parquetWriter.write(record);
            }
        }

        // Convert the Parquet file to InputStream
        InputStream inputStream = new FileInputStream(tempFile);

        return inputStream;
    }

    // Example usage
    public static void main(String[] args) {
        List<String> dataList = Arrays.asList("Hello", "World");

        try {
            InputStream parquetInputStream = convertListToParquetInputStream(dataList);
            // Use the parquetInputStream as needed
            // For example, you can write it to a file or send it over a network.
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
