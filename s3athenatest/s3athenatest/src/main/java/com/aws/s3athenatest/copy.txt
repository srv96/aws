private static void copyCellStyle(XSSFCellStyle fromStyle, HSSFCellStyle toStyle, HSSFWorkbook targetWorkbook) {
    // Copy font
    HSSFFont toFont = targetWorkbook.createFont();
    XSSFFont fromFont = fromStyle.getFont();
    toFont.setBold(fromFont.getBold());
    toFont.setItalic(fromFont.getItalic());
    toFont.setFontName(fromFont.getFontName());
    toFont.setFontHeight(fromFont.getFontHeight());
    
    // Extract the color index from XSSFColor (if it's not null)
    XSSFColor xssfColor = fromFont.getXSSFColor();
    if (xssfColor != null) {
        byte[] rgb = xssfColor.getRGB();
        if (rgb != null && rgb.length == 3) {
            HSSFColor hssfColor = targetWorkbook.getCustomPalette().findColor(rgb[0], rgb[1], rgb[2]);
            if (hssfColor != null) {
                short colorIndex = hssfColor.getIndex();
                toFont.setColor(colorIndex);
            }
        }
    }

    // Copy cell's style
    toStyle.setAlignment(fromStyle.getAlignment());
    toStyle.setVerticalAlignment(fromStyle.getVerticalAlignment());
    toStyle.setDataFormat(fromStyle.getDataFormat());
    toStyle.setFillForegroundColor(fromStyle.getFillForegroundColor());
    toStyle.setFillBackgroundColor(fromStyle.getFillBackgroundColor());
    toStyle.setFont(toFont);
}
